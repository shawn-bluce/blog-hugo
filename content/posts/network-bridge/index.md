---
title: "åœ¨ Linux ä¸­ä½¿ç”¨ç½‘æ¡¥ bridge"
slug: "network-bridge"
date: "2021-01-09T06:32:00+0000"
lastmod: "2025-01-16T09:17:58+0000"
draft: false
tags:
  - "Bridge"
  - "Linux"
  - "Network"
visibility: "public"
---
# 0X00 ä»€ä¹ˆæ˜¯ç½‘æ¡¥

æ™®é€šçš„æ¡¥å°±æ˜¯è¿æ¥æœ¬æ¥ä¸é€šçš„è·¯çš„åŸºç¡€è®¾æ–½ï¼Œç½‘æ¡¥å°±æ˜¯ç”¨æ¥æœ¬æ¥ä¸é€šçš„ç½‘çš„è®¾å¤‡ã€‚ä½†æ˜¯è¿™é‡Œä»‹ç»çš„ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ç‰©ç†è®¾å¤‡ï¼Œè€Œæ˜¯åœ¨ Linux ä¸Šåˆ›å»ºçš„è™šæ‹Ÿè®¾å¤‡ã€‚Linux ä¸Šä¸ä»…å¯ä»¥åˆ›å»ºè™šæ‹Ÿç½‘å¡ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºè™šæ‹Ÿç½‘æ¡¥ï¼Œæ‰€ä»¥è¯´æˆ‘ä»¬åœ¨ Linux ç¯å¢ƒä¸‹å­¦ä¹ ç½‘ç»œçŸ¥è¯†ç¡®å®æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼ˆé™¤éä½ æœ‰é’±ä¹°ä¸€å †ç‰©ç†è®¾å¤‡ğŸ¤£ï¼‰ã€‚

> æ¡¥æ¥å™¨ï¼ˆè‹±è¯­ï¼šnetwork bridgeï¼‰ï¼Œåˆç§°ç½‘æ¡¥ï¼Œä¸€ç§ç½‘ç»œè®¾å¤‡ï¼Œè´Ÿè´£ç½‘ç»œæ¡¥æ¥ï¼ˆnetwork bridgingï¼‰ã€‚æ¡¥æ¥å™¨å°†ç½‘ç»œçš„å¤šä¸ªç½‘æ®µåœ¨æ•°æ®é“¾è·¯å±‚ï¼ˆOSIæ¨¡å‹ç¬¬2å±‚ï¼‰è¿æ¥èµ·æ¥ï¼ˆå³æ¡¥æ¥ï¼‰ã€‚ -- [Wikipedia](<https://zh.wikipedia.org/zh-cn/%E6%A9%8B%E6%8E%A5%E5%99%A8>)

# 0X01 ç½‘æ¡¥æœ‰ä»€ä¹ˆç”¨

ç½‘æ¡¥çš„æœ¬è´¨å°±æ˜¯å°†äº’ä¸è¿é€šçš„ç½‘å¡æ¥åˆ°ä¸€èµ·ï¼ŒåŸåˆ™ä¸Šåªæœ‰è¿™ä¹ˆç®€å•çš„åŠŸèƒ½ï¼Œå…·ä½“åœ¨è¿™ä¸ªåŠŸèƒ½ä¹‹ä¸Šèƒ½åšä»€ä¹ˆäº‹å°±çœ‹æˆ‘ä»¬è‡ªå·±äº†ã€‚

å¦‚æœç”¨è¿‡ Docker çš„è¯å¯ä»¥çœ‹ä¸€ä¸‹è‡ªå·±æœ¬åœ°çš„ç½‘ç»œæ‹“æ‰‘ï¼Œå®é™…ä¸Š Docker çš„å®¹å™¨é—´é€šä¿¡å’Œå¤–ç½‘è®¿é—®ä¹Ÿæ˜¯ç”¨åˆ°äº† bridge çš„ã€‚

æœ€ç›´è§‚çš„ä¸€ç§æ“ä½œå°±æ˜¯ï¼šç”¨ä¸€å°åŒç½‘å¡æœºå™¨ä¸²åœ¨ä¸¤å°ä¸»æœºä¹‹é—´ï¼Œç”¨æ¥ç›‘å¬ç”šè‡³ä¿®æ”¹æ•°æ®åŒ…ã€‚ä¹ä¸€çœ‹è¿™å¥½åƒæ˜¯æåäº‹è¦ç”¨çš„æŠ€æœ¯æ‰‹æ®µå‘ï¼Œçš„ç¡®ã€‚å¦‚æœæœ‰äººæ‹¿ä¸€ä¸ªåŒç½‘å¡çš„å°æœºå™¨ï¼ˆæ¯”å¦‚æ ‘è“æ´¾ï¼‰ä¸²åœ¨äº†ä½ çš„å…‰çŒ«å’Œè·¯ç”±å™¨ä¹‹é—´ï¼Œé‚£ä¹ˆè¿æ¥åˆ°è·¯ç”±å™¨çš„æ‰€æœ‰å¤–ç½‘è¯·æ±‚éƒ½ä¼šç»è¿‡è¿™å°å°æœºå™¨ã€‚å¦‚æœä½ çš„æµé‡ä¸åŠ å¯†ï¼Œæ¯”å¦‚ç”¨httpåè®®æˆ–è€…ftpåè®®è¿™ç§ï¼Œé‚£åˆ«äººæ˜¯å¯ä»¥çœ‹åˆ°ä¸­é—´çš„æ‰€æœ‰å†…å®¹çš„ï¼ŒåŒ…æ‹¬ç™»å½•çš„å¯†ç ä¹‹ç±»çš„ã€‚æ‰€ä»¥è¿™ä¹Ÿæ˜¯â€œä¸è¦éšä¾¿è¿æ¥æ¥è·¯ä¸æ˜çš„ Wi-Fiâ€ ä¸€å¤§ç†ç”±ã€‚

å½“ç„¶ä¹Ÿä¸åªæ˜¯åšåäº‹ï¼Œç°åœ¨çš„å¥½å¤š WAFï¼ˆWeb Application Firewallï¼‰éƒ½æ˜¯å¯ä»¥æ”¯æŒ â€œé€æ˜æ¨¡å¼éƒ¨ç½²â€ çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æŠŠè¿™ç§å®‰å…¨è½¯ä»¶æ‰€åœ¨çš„æœºå™¨ä¸²åœ¨ä½ çš„ç½‘å…³å’Œ web æœåŠ¡å™¨ä¹‹é—´ï¼Œå°±å¯ä»¥åœ¨ä¸ç ´åç½‘ç»œæ‹“æ‰‘çš„æƒ…å†µä¸‹åšåˆ°å®‰å…¨é˜²æŠ¤ã€‚

å¦‚æœä½ æƒ³ç”¨è¿™ç§æ–¹å¼æ¥åšè½¯è·¯ç”±ã€ç»•å¼€å­¦æ ¡çš„ç½‘ç»œå…±äº«é™åˆ¶ï¼Œæˆ–æ˜¯åšæµé‡åˆ†æéƒ½æ˜¯å¯ä»¥å®ç°çš„ã€‚

# 0X02 å®éªŒç¯å¢ƒ

å¦‚æœè¦è·Ÿç€åšä¸€ä¸‹çš„è¯ï¼Œéœ€è¦ç®€å•é…ç½®ä¸€ä¸‹ç¯å¢ƒï¼š

![](https://blog-1251664340.cos.ap-chengdu.myqcloud.com/linux_bridge.png)

é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸‰å°è™šæ‹Ÿæœºï¼Œæœ‰äº›äººç”¨Virtualboxã€VMware Workstationã€æœ‰äº›äººåˆåœ¨ç”¨VMware Fusionç”šè‡³æœ‰ç›´æ¥ç”¨ KVM çš„ï¼Œæ¯ä¸ªçš„æ“ä½œéƒ½ä¸å¤ªä¸€æ ·ï¼Œæˆ‘ä»¬æœ€ç»ˆéƒ½æ˜¯éœ€è¦æœ‰ä¸€å¥—è¿™æ ·çš„ç¯å¢ƒã€‚

ä¸‰å°è™šæ‹Ÿæœºï¼Œserver_1 æœ‰ä¸€å¼ ç½‘å¡ï¼Œé…ç½®é™æ€ ipv4 åœ°å€ä¸º `192.168.1.1/24`ï¼Œserver_2 æœ‰ä¸¤å¼ ç½‘å¡ï¼Œåˆ†åˆ«ä¸ server_1 å’Œ server_3 ç›¸è¿ï¼Œserver_3 æœ‰ä¸€å¼ ç½‘å¡ï¼Œé…ç½®é™æ€ ipv4 åœ°å€ä¸º `192.168.1.2/24`ã€‚å½“ç„¶å¦‚æœè™šæ‹Ÿæœºè½¯ä»¶ä¸èƒ½è®©ä¸¤å°æœºå™¨ç›´è¿çš„è¯å¯ä»¥é€šè¿‡åœ¨æœºå™¨é—´åŠ è·¯ç”±å™¨æˆ–è€…äº¤æ¢æœºçš„æ–¹å¼å°†å…¶è¿æ¥èµ·æ¥ã€‚

æ­¤æ—¶ server_1 å’Œ server_3 çš„ ip è™½ç„¶åœ¨åŒä¸€ç½‘æ®µï¼Œä½†æ˜¯åº”è¯¥æ˜¯ä¸é€šçš„ã€‚

> å¦‚æœè¿™æ—¶å€™ä½ çš„ç½‘ç»œå·²ç»é€šäº†ï¼Œé‚£è¯æ˜è™šæ‹Ÿæœºå’Œè™šæ‹Ÿè·¯ç”±å™¨é…ç½®æœ‰è¯¯ã€‚æœ‰ä¸€ç‚¹æ˜¯éœ€è¦ç¡®è®¤çš„ï¼šå¦‚æœä½ ç”¨åˆ°äº†è™šæ‹Ÿè·¯ç”±å™¨çš„è¯ï¼Œè·¯ç”±å™¨è¦ç¦ç”¨ DHCP æˆ–æ˜¯ç»™ä¸¤å°è·¯ç”±å™¨é…ç½®ä¸åŒçš„ç½‘æ®µä¾‹å¦‚ `1.1.1.0/24` å’Œ `1.1.2.0/24`

# 0X03 å¦‚ä½•é…ç½®ç½‘æ¡¥

å¥½çš„æˆ‘ä»¬å¼€å§‹é…ç½®ç½‘æ¡¥ï¼Œå…¶å®è¿‡ç¨‹å¾ˆç®€å•ï¼Œæ€»å…±åˆ†å››æ­¥ï¼šåˆ›å»ºç½‘æ¡¥ï¼Œå°† server_2 çš„ ens33 ç½‘å¡è¿æ¥åˆ°ç½‘æ¡¥ä¸Šï¼Œå°† server_2 çš„ ens34 ç½‘å¡è¿æ¥åˆ°ç½‘æ¡¥ä¸Šï¼Œå°†ç½‘æ¡¥å¯ç”¨ã€‚

é¦–å…ˆåœ¨ server_1 ä¸Šæ‰§è¡Œ `ping 192.168.1.2`ï¼Œæ­¤æ—¶ç½‘ç»œæ˜¯ä¸é€šçš„ï¼Œä¸è¦åœï¼Œä¸€ç›´å«ä»– ping å°±å¥½ï¼Œä¸€ä¼šå„¿é€šäº†å¯ä»¥ç¬é—´çœ‹åˆ°æ•ˆæœã€‚

åœ¨ server_2 ä¸Šæ‰§è¡Œ

```sh
    ip link add name br0 type bridge     # åˆ›å»ºä¸€ä¸ªåä¸º br0 çš„ç½‘æ¡¥

    ip link set dev ens33 master br0     # å°† ens33 æ¥åˆ° br0 ä¸Š
    ip link set dev ens34 master br0     # å°† ens34 æ¥åˆ° br0 ä¸Š

    ip link set dev br0 up               # å¯ç”¨ br0 è¿™æ—¶ç½‘ç»œåº”è¯¥é€šäº†

    ip link set dev ens33 nomaster       # å°† ens33 ä¸ br0 æ–­å¼€è¿æ¥
    ip link set dev ens34 nomaster       # å°† ens34 ä¸ br0 æ–­å¼€è¿æ¥

    ip link set dev br0 down             # down æ‰ br0

    ip link del br0                      # åˆ é™¤ç½‘æ¡¥
```